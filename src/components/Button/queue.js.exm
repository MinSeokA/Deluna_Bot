const { ButtonInteraction, EmbedBuilder, Colors } = require("discord.js");
const DiscordBot = require("../../client/DiscordBot");
const Component = require("../../structure/Component");

module.exports = new Component({
    customId: 'queue.display', // ë²„íŠ¼ í´ë¦­ ì‹œ ì‚¬ìš©í•  custom ID
    type: 'button',
    /**
     * 
     * @param {DiscordBot} client 
     * @param {ButtonInteraction} interaction 
     */
    run: async (client, interaction) => {
        // í”Œë ˆì´ì–´ ê°€ì ¸ì˜¤ê¸°
        const player = client.music.getPlayer(interaction.guildId);
        if (!player || !player.queue || player.queue.tracks.length === 0) {
            return interaction.reply({
                content: 'ğŸš« í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.',
                ephemeral: true
            });
        }

        // ì¬ìƒ ëª©ë¡ì„ ë¬¸ìì—´ë¡œ ë³€í™˜
        const queueList = player.queue.tracks.map((track, index) => {
            return `${index + 1}. [${track.info.title}](${track.info.uri}) - ${track.info.author}`;
        }).join('\n');

        // ì¬ìƒ ëª©ë¡ ì„ë² ë“œ ìƒì„±
        const queueEmbed = new EmbedBuilder()
            .setColor(Colors.Blue)
            .setTitle(`ğŸ¶ í˜„ì¬ ì¬ìƒ ëª©ë¡`)
            .setDescription(queueList || 'ëŒ€ê¸°ì—´ì— íŠ¸ë™ì´ ì—†ìŠµë‹ˆë‹¤.')
            .setFooter({ text: `ì´ ${player.queue.tracks.length}ê°œì˜ íŠ¸ë™ì´ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.` })
            .setTimestamp();

        // ì‘ë‹µ
        await interaction.reply({
            embeds: [queueEmbed],
            ephemeral: true // ì—í”¼hemeralë¡œ ì„¤ì •í•˜ì—¬ í•´ë‹¹ ì‚¬ìš©ìë§Œ ë³¼ ìˆ˜ ìˆë„ë¡
        });
    }
}).toJSON();
