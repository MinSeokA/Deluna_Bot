const { ButtonInteraction, EmbedBuilder, Colors } = require("discord.js");
const DiscordBot = require("../../client/DiscordBot");
const Component = require("../../structure/Component");

module.exports = new Component({
    customId: 'queue.display', // 버튼 클릭 시 사용할 custom ID
    type: 'button',
    /**
     * 
     * @param {DiscordBot} client 
     * @param {ButtonInteraction} interaction 
     */
    run: async (client, interaction) => {
        // 플레이어 가져오기
        const player = client.music.getPlayer(interaction.guildId);
        if (!player || !player.queue || player.queue.tracks.length === 0) {
            return interaction.reply({
                content: '🚫 현재 재생 중인 음악이 없습니다.',
                ephemeral: true
            });
        }

        // 재생 목록을 문자열로 변환
        const queueList = player.queue.tracks.map((track, index) => {
            return `${index + 1}. [${track.info.title}](${track.info.uri}) - ${track.info.author}`;
        }).join('\n');

        // 재생 목록 임베드 생성
        const queueEmbed = new EmbedBuilder()
            .setColor(Colors.Blue)
            .setTitle(`🎶 현재 재생 목록`)
            .setDescription(queueList || '대기열에 트랙이 없습니다.')
            .setFooter({ text: `총 ${player.queue.tracks.length}개의 트랙이 대기 중입니다.` })
            .setTimestamp();

        // 응답
        await interaction.reply({
            embeds: [queueEmbed],
            ephemeral: true // 에피hemeral로 설정하여 해당 사용자만 볼 수 있도록
        });
    }
}).toJSON();
